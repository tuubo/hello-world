## 4.3 表示処理に伴う問題

### HTML エスケープ

- 通常要素：`<` と `&` を文字参照にする
- 属性値：属性値を `"` で囲み、`<` と `&` と `"` を文字参照にする

HTML エスケープが適切にできていない場合、攻撃者が好きな属性や HTML 要素をコード上に追加し XSS 攻撃を仕掛ける事を許してしまう可能性がある。

- `src` などの属性値(URL)に javascript スキームを渡すと、 JavaScript を起動できる。

#### 対策

`http:` または `https:` で始まる絶対 URL、`/` で始まる相対 URL のどちらかのみを許容するようにチェックする。

## 4.4 SQL 呼び出しに伴う脆弱性

### SQL インジェクション

- SQL の呼び出し方に不備がある場合に発生する
- DB の情報漏えい、DB の書き換え、認証回避等の影響の大きい攻撃になりうる
- 静的プレースホルダを用いて SQL を呼び出すことで、SQL インジェクションを回避できる

## 4.5 「重要な処理」の際に混入する脆弱性

### クロスサイト・リクエストフォージェリ（CSRF）

- CSRF はサーバー側の処理を悪用し、XSS はブラウザ上で不正な処理が実行される事で攻撃が起きる

#### 脆弱性の原因

- form 要素の action 属性にはどのドメインの URL でも指定できる：罠サイトから本サイトにリクエストを送れる
- クッキーに保管されたセッション ID は、対象サイトに自動的に送信される：罠経由のリクエストにもクッキー値が送信される

#### 対策

- CSRF 対策の必要なページを区別する
- 正規利用者の意図したリクエストを確認できるように実装する
  - 秘密情報（token）の埋め込み
  - パスワード再入力
  - Referer のチェック

重要な処理実行後に、通知メールを送信することも CSRF 脆弱性への保険的対策になる。
（攻撃事態は防げずとも、不正な処理が行われたことが発覚し被害が拡大しにくくなる）

### クリックジャッキング

- 攻撃対象ページを罠ページで隠し、利用者が気づかないうちに攻撃対象サイトでのクリックを誘導する。

#### 対策

- X-Frame-Options ヘッダに DENY もしくは SAMEORIGIN を指定することで、iframe の参照を制限する
